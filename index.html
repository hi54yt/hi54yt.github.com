<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>sniffer&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="sniffer's blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="sniffer's blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="sniffer's blog">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="sniffer&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">sniffer&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/links">Links</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-find-closest-network-backend" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/28/find-closest-network-backend/" class="article-date">
  <time datetime="2016-04-28T01:46:02.000Z" itemprop="datePublished">2016-04-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gis/">gis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/28/find-closest-network-backend/">实现最短路径查找服务端api</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>实现最短路径查找，需要服务端配合：<br>以ruby为例，首先创建一个私有方法，用来获取“附近”的node，作为开始位置和结束位置<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_closest_network_node</span></span>(x, y, floor)</span><br><span class="line">  res = <span class="constant">CONN</span>.execute(%<span class="constant">Q</span>&#123;<span class="constant">SELECT</span> verts.id <span class="keyword">as</span> id <span class="constant">FROM</span> public.networklines_3857_vertices_pgr <span class="constant">AS</span> verts</span><br><span class="line">                        <span class="constant">INNER</span> <span class="constant">JOIN</span> (select <span class="constant">ST_PointFromText</span>(<span class="string">'POINT(<span class="subst">#&#123;x&#125;</span> <span class="subst">#&#123;y&#125;</span> <span class="subst">#&#123;floor&#125;</span>)'</span>, <span class="number">3857</span>)<span class="keyword">as</span> geom) <span class="constant">AS</span> pt</span><br><span class="line">                        <span class="constant">ON</span> <span class="constant">ST_DWithin</span>(verts.the_geom, pt.geom, <span class="number">100.0</span>)</span><br><span class="line">                        <span class="constant">WHERE</span> <span class="constant">ST_Z</span>(verts.the_geom) = <span class="comment">#&#123;floor&#125;</span></span><br><span class="line">                        <span class="constant">ORDER</span> <span class="constant">BY</span> <span class="constant">ST_3DDistance</span>(verts.the_geom, pt.geom) <span class="constant">LIMIT</span> <span class="number">1</span>&#125;)</span><br><span class="line">  <span class="keyword">if</span> res.ntuples != <span class="number">0</span></span><br><span class="line">    res.getvalue(<span class="number">0</span>,<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>然后创建获取最短路径的geoJSON，以供前台展示用，比如leaflet等：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">def map_path</span><br><span class="line">  start_x = params[:start_x]</span><br><span class="line">  start_y = params[:start_y]</span><br><span class="line">  start_floor = Beacon.find_by_name(params[:start_minor].to_i).floor.num</span><br><span class="line"></span><br><span class="line">  end_x = params[:end_x]</span><br><span class="line">  end_y = params[:end_y]</span><br><span class="line">  end_floor = Beacon.find_by_name(params[:end_minor].to_i).floor.num</span><br><span class="line"></span><br><span class="line">  <span class="comment">//获取开始位置和结束位置的node id</span></span><br><span class="line">  start_node_id = find_closest_network_node(start_x, start_y, start_floor)</span><br><span class="line">  end_node_id = find_closest_network_node(end_x, end_y, end_floor)</span><br><span class="line"></span><br><span class="line">  <span class="comment">//通过数据库查询最短路径的拓扑数据，指定返回的拓扑结果为geoJSON格式</span></span><br><span class="line">  <span class="keyword">if</span> start_node_id.present? &amp;&amp; end_node_id.present?</span><br><span class="line">    res = CONN.execute(%Q&#123;SELECT seq, id1 <span class="keyword">AS</span> node, id2 <span class="keyword">AS</span> edge,</span><br><span class="line">            total_cost <span class="keyword">AS</span> cost, layer,</span><br><span class="line">            type_id, ST_AsGeoJSON(wkb_geometry) <span class="keyword">AS</span> geoj</span><br><span class="line">            FROM pgr_dijkstra(</span><br><span class="line">              <span class="string">'SELECT ogc_fid as id, source, target,</span><br><span class="line">                   st_length(wkb_geometry) AS cost,</span><br><span class="line">                   layer, type_id</span><br><span class="line">               FROM public.networklines_3857'</span>,</span><br><span class="line">              <span class="comment">#&#123;start_node_id&#125;, #&#123;end_node_id&#125;, FALSE, FALSE</span></span><br><span class="line">            ) <span class="keyword">AS</span> dij_route</span><br><span class="line">            JOIN  <span class="keyword">public</span>.networklines_3857 <span class="keyword">AS</span> input_network</span><br><span class="line">            ON dij_route.id2 = input_network.ogc_fid&#125;)</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> render nothing: <span class="keyword">true</span>, status: <span class="number">404</span></span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  <span class="comment">//拼装成leaflet所用的格式返回给客户端</span></span><br><span class="line">  route_features = []</span><br><span class="line"></span><br><span class="line">  res.each <span class="keyword">do</span> |segment|</span><br><span class="line"></span><br><span class="line">    seg_cost = segment[<span class="string">'cost'</span>]      <span class="comment"># cost value</span></span><br><span class="line">    layer_level = segment[<span class="string">'layer'</span>].to_i   <span class="comment"># floor number</span></span><br><span class="line">    seg_type = segment[<span class="string">'type_id'</span>]</span><br><span class="line">    geojs = JSON.parse(segment[<span class="string">'geoj'</span>])         <span class="comment"># geojson coordinates</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    geojs[<span class="string">"coordinates"</span>].each <span class="keyword">do</span> |geo|</span><br><span class="line">      lon = geo[<span class="number">0</span>]</span><br><span class="line">      lat = geo[<span class="number">1</span>]</span><br><span class="line">      point = unproject(lon, lat)</span><br><span class="line">      geo[<span class="number">0</span>] = point[:x]</span><br><span class="line">      geo[<span class="number">1</span>] = point[:y]</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    <span class="comment"># build geojson</span></span><br><span class="line">    feature = &#123; <span class="string">"type"</span>: <span class="string">"Feature"</span>,</span><br><span class="line">                <span class="string">"geometry"</span>: geojs,</span><br><span class="line">                <span class="string">"properties"</span>: &#123;<span class="string">"floor"</span>: layer_level,</span><br><span class="line">                               <span class="string">"length"</span>: seg_cost,</span><br><span class="line">                               <span class="string">"type_id"</span>: seg_type&#125;</span><br><span class="line">              &#125;</span><br><span class="line">    route_features &lt;&lt; feature</span><br><span class="line">  end</span><br><span class="line">  @path = &#123; <span class="string">"type"</span>: <span class="string">"FeatureCollection"</span>,</span><br><span class="line">    <span class="string">"features"</span>: route_features</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  respond_to <span class="keyword">do</span> |format|</span><br><span class="line">    format.json &#123; render json: @path &#125;</span><br><span class="line">  end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/28/find-closest-network-backend/" data-id="cinjn73wx001h501ad8zd234g" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-rails-ajax-tips" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/20/rails-ajax-tips/" class="article-date">
  <time datetime="2016-04-20T01:23:26.000Z" itemprop="datePublished">2016-04-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/rails/">rails</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/20/rails-ajax-tips/">rails ajax tips</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>前不久在做一个rails项目时，要实现一个ajax刷新页面效果，rails能收到发来的请求，但是总是去渲染html页面，而不是渲染对应的js.erb文件，而这个controller里的action需要同时响应html和ajax请求。</p>
<p>那么rails是怎么和ajax结合的呢，首先要了解什么是SJR（Server-generated JavaScript Responses），这个可以看DHH大神的文章，翻译版：<a href="https://ruby-china.org/topics/16132" target="_blank" rel="external">https://ruby-china.org/topics/16132</a></p>
<p>首先rails传统的ajax方案是给link或者form加一个:remote =&gt; true, 这样做会由jquery-ujs对链接进行劫持把普通请求变成ajax请求，其中很重要的一条就是增加一个datatype参数，然后在request请求中会带上Accept参数，rails会根据Accept进行响应分发。比如datatype为script，则响应js文件，datatype为json，则响应json文件。jquery-ujs默认的datatype为script。<br>这样做的话，那么下面的请求都会正常响应：<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="variable">%=</span> link_to <span class="string">'index'</span>, root_url <span class="variable">%&gt;</span> <span class="comment">//返回html</span></span><br><span class="line">&lt;<span class="variable">%=</span> link_to <span class="string">'index'</span>, root_url, :remote =&gt; true <span class="variable">%&gt;</span> <span class="comment">//返回js</span></span><br></pre></td></tr></table></figure></p>
<p>你还可以指定请求类型：<br><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= link_to <span class="string">'index'</span>, root_url, :remote =&gt; <span class="keyword">true</span>, <span class="string">"data-type"</span> =&gt; :json %&gt; <span class="comment">//返回json</span></span><br></pre></td></tr></table></figure></p>
<p>如果自己写ajax请求的话要注意带上dataType，以保证rails正确响应你的请求：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  method: method,</span><br><span class="line">  url: action,</span><br><span class="line">  data: data,</span><br><span class="line">  dataType: <span class="string">'script'</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>还有一种方案是在url中带上后缀，利用route将format传入action：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">  method: method,</span><br><span class="line">  url: http:<span class="comment">//127.0.0.1:3000/index.js,</span></span><br><span class="line">  data: data,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>action会根据format进行响应：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">respond_to <span class="built_in">do</span> |<span class="built_in">format</span>|</span><br><span class="line">    <span class="built_in">format</span>.html</span><br><span class="line">    <span class="built_in">format</span>.js &#123;&#125;<span class="comment"> //返回js</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure></p>
<p>参考：<br><a href="http://tech.thereq.com/post/17243732577/rails-3-using-linkto-remote-true-with-jquery" target="_blank" rel="external">http://tech.thereq.com/post/17243732577/rails-3-using-linkto-remote-true-with-jquery</a><br><a href="http://roseweixel.github.io/blog/2015/07/05/integrating-ajax-and-rails-a-simple-todo-list-app/" target="_blank" rel="external">http://roseweixel.github.io/blog/2015/07/05/integrating-ajax-and-rails-a-simple-todo-list-app/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/20/rails-ajax-tips/" data-id="cinjn73vu000q501a0kv99xfi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux服务器常用命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/04/01/linux服务器常用命令/" class="article-date">
  <time datetime="2016-04-01T06:44:40.000Z" itemprop="datePublished">2016-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/linux/">linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/01/linux服务器常用命令/">linux服务器常用命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.查看磁盘配额<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">df</span> -h</span><br></pre></td></tr></table></figure></p>
<img title="查看磁盘配额" alt="查看磁盘配额" src="http://sniffer-blog.qiniudn.com/static/images/df-h.png">
<p>2.更详细的查看磁盘配额<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncdu</span><br></pre></td></tr></table></figure></p>
<img title="更详细的查看磁盘配额" alt="更详细的查看磁盘配额" src="http://sniffer-blog.qiniudn.com/static/images/ncdu.png">
<p>3.查看网络流量<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nload</span><br></pre></td></tr></table></figure></p>
<img title="查看网络流量" alt="查看网络流量" src="http://sniffer-blog.qiniudn.com/static/images/nload.png">

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/04/01/linux服务器常用命令/" data-id="cinjn73we0013501aymffbsbc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-正确配置geoserver标签label的姿势" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/22/正确配置geoserver标签label的姿势/" class="article-date">
  <time datetime="2016-03-22T07:32:12.000Z" itemprop="datePublished">2016-03-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gis/">gis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/22/正确配置geoserver标签label的姿势/">正确配置geoserver标签(label)的姿势</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>label是地图上不可或缺的元素，geoserver的label是在geoserver的style文件中配置的，以下是我生产环境中的label配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">Rule</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="title">TextSymbolizer</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--  配置显示label文字的属性，我这里是label --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">Label</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">ogc:PropertyName</span>&gt;</span>label<span class="tag">&lt;/<span class="title">ogc:PropertyName</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">Label</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">Font</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="title">CssParameter</span> <span class="attribute">name</span>=<span class="value">"font-size"</span>&gt;</span>12.0<span class="tag">&lt;/<span class="title">CssParameter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="title">CssParameter</span> <span class="attribute">name</span>=<span class="value">"font-style"</span>&gt;</span>normal<span class="tag">&lt;/<span class="title">CssParameter</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="title">CssParameter</span> <span class="attribute">name</span>=<span class="value">"font-weight"</span>&gt;</span>bold<span class="tag">&lt;/<span class="title">CssParameter</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="title">Font</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">Fill</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">CssParameter</span> <span class="attribute">name</span>=<span class="value">"fill"</span>&gt;</span>#990099<span class="tag">&lt;/<span class="title">CssParameter</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">Fill</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- 取消默认的label重复显示 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">Geometry</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">ogc:Function</span> <span class="attribute">name</span>=<span class="value">"centroid"</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="title">ogc:PropertyName</span>&gt;</span>the_geom<span class="tag">&lt;/<span class="title">ogc:PropertyName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">ogc:Function</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">Geometry</span>&gt;</span></span><br><span class="line">   <span class="comment">&lt;!-- label旋转角度 --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">LabelPlacement</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">PointPlacement</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">Rotation</span>&gt;</span></span><br><span class="line">       45</span><br><span class="line">       <span class="tag">&lt;/<span class="title">Rotation</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">PointPlacement</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">LabelPlacement</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">TextSymbolizer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">Rule</span>&gt;</span></span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/22/正确配置geoserver标签label的姿势/" data-id="cinjn73va0008501at80rr9ps" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/室内地图/">室内地图</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-geoserver地图显示图标" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/22/geoserver地图显示图标/" class="article-date">
  <time datetime="2016-03-22T06:05:39.000Z" itemprop="datePublished">2016-03-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gis/">gis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/22/geoserver地图显示图标/">geoserver地图显示图标</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>geoserver地图上显示图标是常见的功能，比如一张室内地图上需要显示卫生间、电梯等图标。<br><img title="wms地图" alt="wms地图" class="class1" src="http://sniffer-blog.qiniudn.com/static/images/icon_on_map.png?imageView2/2/w/600"><br>根据网上的资料整理出以下步骤：<br>1.上传需要显示的图标到geoserver的styles目录下，一般生产环境下是这个目录：<br><code>/var/lib/tomcat7/webapps/geoserver/data/styles</code><br>2.配置地图的sld样式文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">Rule</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">Name</span>&gt;</span><span class="tag">&lt;/<span class="title">Name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">ogc:Filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">ogc:PropertyIsEqualTo</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">ogc:PropertyName</span>&gt;</span>type<span class="tag">&lt;/<span class="title">ogc:PropertyName</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">ogc:Literal</span>&gt;</span>toilet<span class="tag">&lt;/<span class="title">ogc:Literal</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">ogc:PropertyIsEqualTo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">ogc:Filter</span>&gt;</span></span><br><span class="line"></span><br><span class="line"> <span class="tag">&lt;<span class="title">PointSymbolizer</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">Graphic</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">ExternalGraphic</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="title">OnlineResource</span> <span class="attribute">xlink:type</span>=<span class="value">"simple"</span> <span class="attribute">xlink:href</span>=<span class="value">"http://wms.smart-museum.cn/geoserver/styles/wc.png"</span> /&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="title">Format</span>&gt;</span>image/png<span class="tag">&lt;/<span class="title">Format</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="title">ExternalGraphic</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">Size</span>&gt;</span>20<span class="tag">&lt;/<span class="title">Size</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">Graphic</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">VendorOption</span> <span class="attribute">name</span>=<span class="value">"labelObstacle"</span>&gt;</span>true<span class="tag">&lt;/<span class="title">VendorOption</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="title">PointSymbolizer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">Rule</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>因为我们上传图片到styles目录，所以xlink:href这个属性可以配置成绝对路径<code>xlink:type=&quot;simple&quot; xlink:href=&quot;wc.png&quot;</code>，但是我的服务器上不知道什么原因就是不行，所以这里配置了绝对路径。以后查明了原因在更新。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/22/geoserver地图显示图标/" data-id="cinjn73wt001e501a5otnldgj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/室内地图/">室内地图</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-set-hexo-jquery-google-fonts-cdn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/09/set-hexo-jquery-google-fonts-cdn/" class="article-date">
  <time datetime="2016-03-09T08:02:37.000Z" itemprop="datePublished">2016-03-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/hexo/">hexo</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/09/set-hexo-jquery-google-fonts-cdn/">解决hexo的jquery和fonts被墙</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>因为众所周知的原因，骄傲的中国人是不(wu)用(fa)访问ajax.googleapis.com和fonts.googleapis.com这两个网址的，所以jquery和google fonts会响应超时，严重影响我们的hexo博客的用户体验。解决方法是换成360提供的cdn,以hexo官方默认模版landscape为例：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">打开</span><br><span class="line">themes/landscape/layout/_partial/after-footer.ejs</span><br><span class="line">找到</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line">替换为</span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">打开</span><br><span class="line">themes/landscape/layout/_partial/head.ejs</span><br><span class="line">找到</span><br><span class="line">&lt;link href=<span class="string">"//fonts.googleapis.com/css?family=Source+Code+Pro"</span> rel=<span class="string">"stylesheet"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text/css"</span>&gt;</span><br><span class="line">替换为</span><br><span class="line">&lt;link href=<span class="string">"//fonts.useso.com/css?family=Source+Code+Pro"</span> rel=<span class="string">"stylesheet"</span> <span class="class"><span class="keyword">type</span></span>=<span class="string">"text/css"</span>&gt;</span><br></pre></td></tr></table></figure>
<p>ref: <a href="http://libs.useso.com/" target="_blank" rel="external">http://libs.useso.com/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/09/set-hexo-jquery-google-fonts-cdn/" data-id="cinjn73vr000n501a1rog4j8a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-add-jvm-fonts" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/07/add-jvm-fonts/" class="article-date">
  <time datetime="2016-03-07T08:26:36.000Z" itemprop="datePublished">2016-03-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gis/">gis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/07/add-jvm-fonts/">解决geoserver中文label乱码问题</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>将geoserver部署到ubuntu的时候，遇到label显示中文乱码的问题，一般这个问题都是因为ubuntu的jvm缺少中文字体造成的，记录下解决过程：</p>
<p>进入j2sdk目录，比如/usr/lib/jvm/java-7-openjdk-amd64/jre/lib，创建fallback目录：</p>
<pre><code>sudo <span class="built_in">mkdir</span> fonts/fallback
</code></pre><p>拷贝字体文件到fallback目录</p>
<pre><code>cp xxx.ttf /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">jvm</span>/<span class="title">java</span>-7-<span class="title">openjdk</span>-<span class="title">amd64</span>/<span class="title">jre</span>/<span class="title">lib</span>/<span class="title">fonts</span>/<span class="title">fallback</span></span>
</code></pre><p>安装fontconfig</p>
<pre><code>sudo apt-<span class="keyword">get</span> install fontconfig
</code></pre><p>rebuid fonts caches</p>
<pre><code><span class="built_in">fc</span>-cache –fv
</code></pre><p>restart JVM</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/07/add-jvm-fonts/" data-id="cinjn743b007h501ayuq1qbus" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ionic-cheatsheet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/07/ionic-cheatsheet/" class="article-date">
  <time datetime="2016-03-07T02:33:20.000Z" itemprop="datePublished">2016-03-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ionic/">ionic</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/07/ionic-cheatsheet/">ionic-cheatsheet</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在开发ionic过程中，会遇到各种报错，尤其是新添加了cordova的plugin后，很容易因为依赖问题build不通过，一般采取<strong>重装plugin和platform</strong>来解决：</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo npm <span class="keyword">update</span> -<span class="keyword">g</span> cordova</span><br><span class="line">sudo npm <span class="keyword">update</span> -<span class="keyword">g</span> ionic</span><br><span class="line"><span class="keyword">rm</span> -rf plugins/</span><br><span class="line"><span class="keyword">rm</span> -rf platforms/</span><br><span class="line">ionic platform add ios</span><br><span class="line">ionic <span class="keyword">run</span> ios</span><br></pre></td></tr></table></figure>
<p>安装plugin的时候，如果不想cordova plugin add xxx，而是<strong>一次安装所有的plugin</strong>：</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ionic <span class="keyword">state</span> reset</span><br></pre></td></tr></table></figure>
<p>ref: <a href="https://forum.ionicframework.com/t/how-to-install-all-my-codrova-plugins-listed-in-package-json/21328" target="_blank" rel="external">https://forum.ionicframework.com/t/how-to-install-all-my-codrova-plugins-listed-in-package-json/21328</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/07/ionic-cheatsheet/" data-id="cinjn73wj0016501aj5q6ixwi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-mac-cheatsheet" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/03/01/mac-cheatsheet/" class="article-date">
  <time datetime="2016-03-01T13:20:16.000Z" itemprop="datePublished">2016-03-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Mac/">Mac</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/01/mac-cheatsheet/">打造顺手的开发环境</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文适用于MAC操作系统，程序员的电脑就像职业车手的座驾，应该把开发环境应该调教到最佳状态。以下基于我常用的技术栈react native、rails、git，整理出该环境下的“武功秘籍”：</p>
<h1 id="Rails">Rails</h1><h2 id="第一式">第一式</h2><p>招式：gem install时默认跳过ri、rdoc安装<br>步骤：打开 ~/.gemrc，加入gem: –no-ri –no-rdoc<br>心得：gem install默认会安装doc文件，十分浪费时间，我们有限的生命已经被GFW浪费够多的，这些小地方必须有寸土不让的精神。</p>
<h1 id="NPM">NPM</h1><h2 id="第一式-1">第一式</h2><p>招式：更换npm源<br>步骤：<br>三种办法任意一种都能解决问题，建议使用第三种，将配置写死，下次用的时候配置还在:<br>1.通过config命令</p>
<pre><code>npm config <span class="keyword">set</span> <span class="keyword">registry</span> https://<span class="keyword">registry</span>.npm.taobao.org 
npm <span class="keyword">info</span> underscore （如果上面配置正确这个命令会有字符串response）
</code></pre><p>2.命令行指定</p>
<pre><code><span class="title">npm</span> --registry <span class="url">https://registry.npm.taobao.org</span> <span class="built_in">info</span> underscore 
</code></pre><p>3.编辑 ~/.npmrc 加入下面内容</p>
<pre><code>registry = <span class="string">https:</span><span class="comment">//registry.npm.taobao.org</span>
</code></pre><h1 id="Git">Git</h1><h2 id="第一式-2">第一式</h2><p>招式：增加git alias<br>步骤：<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="keyword">global</span> <span class="keyword">alias</span>.<span class="keyword">alias</span> command</span><br></pre></td></tr></table></figure></p>
<p>For example, I use git status a lot, so a shorter alias would be nice:<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="label">git</span> config --<span class="preprocessor">global</span> <span class="preprocessor">alias</span>.s status</span><br></pre></td></tr></table></figure></p>
<p>This will add the following to your ~/.gitconfig file:<br><figure class="highlight monkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">alias</span>]</span><br><span class="line">  <span class="title">s</span> = status</span><br></pre></td></tr></table></figure></p>
<p>Now if I type git s I get the same output as git status. Of course you can always open ~/.gitconfig in a text editor and add s = status manually under the [alias] section.</p>
<p>ref:<a href="http://oli.jp/2012/git-powerup/" target="_blank" rel="external">http://oli.jp/2012/git-powerup/</a></p>
<h1 id="SSH">SSH</h1><h2 id="第一式-3">第一式</h2><p>招式： 配置ssh config快速登录服务器<br>步骤：<br>打开~/.ssh/config，加入以下内容：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Host hubei</span><br><span class="line">    HostName <span class="number">192.168</span><span class="number">.40</span><span class="number">.11</span></span><br><span class="line">    User hbsb</span><br><span class="line">Host yzsjzx</span><br><span class="line">    HostName <span class="number">42.96</span><span class="number">.206</span><span class="number">.22</span></span><br><span class="line">    User wwwuser</span><br><span class="line">Host camus</span><br><span class="line">    HostName <span class="number">114.215</span><span class="number">.96</span><span class="number">.33</span></span><br><span class="line">    User wwwuser</span><br></pre></td></tr></table></figure></p>
<p>以后可以这样登录服务器：<code>ssh hubei</code></p>
<h1 id="其它">其它</h1><h2 id="第一式-4">第一式</h2><p>招式：禁用DS_Store<br>步骤：<br>在命令行中执行：</p>
<pre><code>defaults write com<span class="class">.apple</span><span class="class">.desktopservices</span> DSDontWriteNetworkStores -bool true
</code></pre><p>删除系统中已经存在的DS_Store文件</p>
<pre><code>sudo <span class="built_in">find</span> / -<span class="built_in">name</span> <span class="string">".DS_Store"</span> -depth -<span class="built_in">exec</span> rm {} \;
</code></pre><p>然后记得重启finder</p>
<pre><code><span class="title">killall</span> Finder
</code></pre><p>心得：<br>.DS_Store是Mac OS保存文件夹的自定义属性的隐藏文件，如文件的图标位置或背景色，相当于Windows的desktop.ini。这个文件经常会随着git提交到项目里，十分没必要。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/03/01/mac-cheatsheet/" data-id="cinjn73w90010501a4trznou4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-室内地图导入postgis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/25/室内地图导入postgis/" class="article-date">
  <time datetime="2016-01-25T01:57:52.000Z" itemprop="datePublished">2016-01-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/gis/">gis</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/25/室内地图导入postgis/">室内地图导航路径导入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>将shapefile导入postgis（以公司四楼五楼路径为例）<br>导入四楼路径规划图，命名为yz_network_lines_04，在命令行中执行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ogr2ogr <span class="operator">-a</span>_srs EPSG:<span class="number">3857</span> -lco <span class="string">"SCHEMA=public"</span> -lco <span class="string">"COLUMN_TYPES=type=varchar,type_id=integer"</span> -nlt MULTILINESTRING -nln yz_network_lines_04 <span class="operator">-f</span> PostgreSQL <span class="string">"PG:host=localhost port=5432 user=sniffer dbname=camus_development"</span> yz_network_lines_04.shp</span><br></pre></td></tr></table></figure></p>
<p>导入五楼路径规划图，命名为yz_network_lines_05，在命令行中执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ogr2ogr <span class="operator">-a</span>_srs EPSG:<span class="number">3857</span> -lco <span class="string">"SCHEMA=public"</span> -lco <span class="string">"COLUMN_TYPES=type=varchar,type_id=integer"</span> -nlt MULTILINESTRING -nln yz_network_lines_05 <span class="operator">-f</span> PostgreSQL <span class="string">"PG:host=localhost port=5432 user=sniffer dbname=camus_development"</span> yz_network_lines_05.shp</span><br></pre></td></tr></table></figure>
<p>添加pgrouting所需的字段，在pgAdmin或者psql中执行:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_04 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">source</span> <span class="built_in">INTEGER</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_04 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> target <span class="built_in">INTEGER</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_04 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">cost</span> <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_04 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">length</span> <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_04 <span class="keyword">set</span> <span class="keyword">length</span> = ST_Length(wkb_geometry);</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_05 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">source</span> <span class="built_in">INTEGER</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_05 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> target <span class="built_in">INTEGER</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_05 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">cost</span> <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.yz_network_lines_05 <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> <span class="keyword">length</span> <span class="keyword">DOUBLE</span> <span class="keyword">PRECISION</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_05 <span class="keyword">set</span> <span class="keyword">length</span> = ST_Length(wkb_geometry);</span></span><br></pre></td></tr></table></figure>
<p>生成pgrouting所需的函数（按顺序执行）:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U username <span class="operator">-d</span> py_geoan_cb <span class="operator">-a</span> <span class="operator">-f</span> pgr_pointtoid3d.sql</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U username <span class="operator">-d</span> py_geoan_cb <span class="operator">-a</span> <span class="operator">-f</span> pgr_createTopology3d.sql</span><br></pre></td></tr></table></figure>
<p>合并四楼五楼路径，导入拓扑结构，需要注意修改表名：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql -U username <span class="operator">-d</span> py_geoan_cb <span class="operator">-a</span> <span class="operator">-f</span> indrz_create_3d_networklines.sql</span><br></pre></td></tr></table></figure></p>
<p>常见问题：</p>
<ol>
<li><p>psql:indrz_create_3d_networklines.sql:81: NOTICE:  ——-&gt; public.networklines_3857 not found<br>原因：用户没有权限<br>解决：ALTER ROLE wwwuser SUPERUSER CREATEROLE CREATEDB REPLICATION;</p>
</li>
<li><p>RGeo::Error::UnsupportedOperation: Proj4 is not supported because the proj4 library was not found at install time.<br>原因：缺少proj本地依赖<br>解决：<br>查看是否支持：</p>
<pre><code><span class="tag">RGeo</span><span class="pseudo">::CoordSys</span><span class="pseudo">::Proj4</span><span class="class">.supported</span>?
</code></pre><p>安装依赖：</p>
<pre><code><span class="label">sudo</span> apt-<span class="preprocessor">get</span> install <span class="keyword">binutils </span>libproj-dev gdal-<span class="keyword">bin</span>
</code></pre><p>重新安装gem：</p>
<pre><code>gem <span class="operator"><span class="keyword">uninstall</span> rgeo
gem <span class="keyword">install</span> rgeo</span>
</code></pre></li>
</ol>
<p>附件：<br>pgr_pointtoid3d.sql</p>
<figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">-- <span class="keyword">Function</span>: <span class="keyword">public</span>.pgr_pointtoid3d(geometry, <span class="built_in">double</span> precision, <span class="keyword">text</span>, <span class="built_in">integer</span>)</span><br><span class="line"></span><br><span class="line">-- DROP <span class="keyword">FUNCTION</span> <span class="keyword">public</span>.pgr_pointtoid3d(geometry, <span class="built_in">double</span> precision, <span class="keyword">text</span>, <span class="built_in">integer</span>);</span><br><span class="line"></span><br><span class="line">CREATE <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> <span class="keyword">public</span>.pgr_pointtoid3d(point geometry, tolerance <span class="built_in">double</span> precision, vertname <span class="keyword">text</span>, srid <span class="built_in">integer</span>)</span><br><span class="line">  RETURNS bigint <span class="keyword">AS</span></span><br><span class="line">$BODY$ </span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">    rec record; </span><br><span class="line">    pid bigint; </span><br><span class="line"></span><br><span class="line">BEGIN</span><br><span class="line">    execute <span class="comment">'SELECT ST_3DDistance(the_geom,ST_GeomFromText(st_astext('||quote_literal(point::text)||'),'||srid||')) AS d, id, the_geom</span></span><br><span class="line">        <span class="keyword">FROM</span> <span class="comment">'||pgr_quote_ident(vertname)||'</span></span><br><span class="line">        <span class="keyword">WHERE</span> ST_DWithin(the_geom, ST_GeomFromText(st_astext(<span class="comment">'||quote_literal(point::text)||'),'||srid||'),'|| tolerance||')</span></span><br><span class="line">        <span class="keyword">ORDER</span> <span class="keyword">BY</span> d</span><br><span class="line">        LIMIT <span class="number">1</span><span class="comment">' INTO rec ;</span></span><br><span class="line">    <span class="keyword">IF</span> rec.id <span class="keyword">is</span> <span class="keyword">not</span> null <span class="keyword">THEN</span></span><br><span class="line">        pid := rec.id;</span><br><span class="line">    <span class="keyword">ELSE</span></span><br><span class="line">        execute <span class="comment">'INSERT INTO '||pgr_quote_ident(vertname)||' (the_geom) VALUES ('||quote_literal(point::text)||')';</span></span><br><span class="line">        pid := lastval();</span><br><span class="line">    <span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">RETURN</span> pid;</span><br><span class="line"></span><br><span class="line"><span class="keyword">END</span>;</span><br><span class="line">$BODY$</span><br><span class="line">  LANGUAGE plpgsql VOLATILE <span class="keyword">STRICT</span></span><br><span class="line">  COST <span class="number">100</span>;</span><br><span class="line">ALTER <span class="keyword">FUNCTION</span> <span class="keyword">public</span>.pgr_pointtoid3d(geometry, <span class="built_in">double</span> precision, <span class="keyword">text</span>, <span class="built_in">integer</span>)</span><br><span class="line">  OWNER <span class="keyword">TO</span> postgres;</span><br><span class="line">COMMENT <span class="keyword">ON</span> <span class="keyword">FUNCTION</span> <span class="keyword">public</span>.pgr_pointtoid3d(geometry, <span class="built_in">double</span> precision, <span class="keyword">text</span>, <span class="built_in">integer</span>) <span class="keyword">IS</span> <span class="comment">'args: point geometry,tolerance,verticesTable,srid - inserts the point into the vertices table using tolerance to determine if its an existing point and returns the id assigned to it';</span></span><br></pre></td></tr></table></figure>
<p>pgr_createTopology3d.sql<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Function: public.pgr_createtopology3d(text, double precision, text, text, text, text, text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- DROP FUNCTION public.pgr_createtopology3d(text, double precision, text, text, text, text, text);</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">FUNCTION</span> <span class="keyword">public</span>.pgr_createtopology3d(edge_table <span class="built_in">text</span>, tolerance <span class="keyword">double</span> <span class="keyword">precision</span>, the_geom <span class="built_in">text</span> <span class="keyword">DEFAULT</span> <span class="string">'the_geom'</span>::<span class="built_in">text</span>, <span class="keyword">id</span> <span class="built_in">text</span> <span class="keyword">DEFAULT</span> <span class="string">'id'</span>::<span class="built_in">text</span>, <span class="keyword">source</span> <span class="built_in">text</span> <span class="keyword">DEFAULT</span> <span class="string">'source'</span>::<span class="built_in">text</span>, target <span class="built_in">text</span> <span class="keyword">DEFAULT</span> <span class="string">'target'</span>::<span class="built_in">text</span>, rows_where <span class="built_in">text</span> <span class="keyword">DEFAULT</span> <span class="string">'true'</span>::<span class="built_in">text</span>)</span><br><span class="line">  <span class="keyword">RETURNS</span> <span class="built_in">character</span> <span class="built_in">varying</span> <span class="keyword">AS</span></span><br><span class="line">$<span class="keyword">BODY</span>$</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span></span><br><span class="line">    points <span class="built_in">record</span>;</span></span><br><span class="line">    sridinfo record;</span><br><span class="line">    source_id bigint;</span><br><span class="line">    target_id bigint;</span><br><span class="line">    totcount bigint;</span><br><span class="line">    rowcount bigint;</span><br><span class="line">    srid integer;</span><br><span class="line">    sql text;</span><br><span class="line">    sname text;</span><br><span class="line">    tname text;</span><br><span class="line">    tabname text;</span><br><span class="line">    vname text;</span><br><span class="line">    vertname text;</span><br><span class="line">    gname text;</span><br><span class="line">    idname text;</span><br><span class="line">    sourcename text;</span><br><span class="line">    targetname text;</span><br><span class="line">    notincluded integer;</span><br><span class="line">    i integer;</span><br><span class="line">    naming record;</span><br><span class="line">    flag boolean;</span><br><span class="line">    query text;</span><br><span class="line">    sourcetype  text;</span><br><span class="line">    targettype text;</span><br><span class="line">    debuglevel text;</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">  <span class="keyword">raise</span> <span class="keyword">notice</span> <span class="string">'PROCESSING:'</span>;</span></span><br><span class="line">  raise notice 'pgr_createTopology3d(''%'',%,''%'',''%'',''%'',''%'',''%'')',edge_table,tolerance,the_geom,id,source,target,rows_where;</span><br><span class="line">  raise notice 'Performing checks, pelase wait .....';</span><br><span class="line">  <span class="operator"><span class="keyword">execute</span> <span class="string">'show client_min_messages'</span> <span class="keyword">into</span> debuglevel;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">RAISE</span> DEBUG <span class="string">'Cheking % exists'</span>,edge_table;</span></span><br><span class="line">    <span class="operator"><span class="keyword">execute</span> <span class="string">'select * from pgr_getTableName('</span>||quote_literal(edge_table)||<span class="string">')'</span> <span class="keyword">into</span> naming;</span></span><br><span class="line">    sname=naming.sname;</span><br><span class="line">    tname=naming.tname;</span><br><span class="line">    IF sname IS NULL OR tname IS NULL THEN</span><br><span class="line">  RAISE NOTICE '<span class="comment">-------&gt; % not found',edge_table;</span></span><br><span class="line">        RETURN 'FAIL';</span><br><span class="line">    ELSE</span><br><span class="line">  RAISE DEBUG '  <span class="comment">-----&gt; OK';</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line"></span><br><span class="line">    tabname=sname||'.'||tname;</span><br><span class="line">    vname=tname||'_vertices_pgr';</span><br><span class="line">    vertname= sname||'.'||vname;</span><br><span class="line">    rows_where = ' AND ('||rows_where||')';</span><br><span class="line">  <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">       <span class="keyword">raise</span> DEBUG <span class="string">'Checking id column "%" columns in  % '</span>,<span class="keyword">id</span>,tabname;</span></span><br><span class="line">       <span class="operator"><span class="keyword">EXECUTE</span> <span class="string">'select pgr_getColumnName('</span>||quote_literal(tabname)||<span class="string">','</span>||quote_literal(the_geom)||<span class="string">')'</span> <span class="keyword">INTO</span> gname;</span></span><br><span class="line">       <span class="operator"><span class="keyword">EXECUTE</span> <span class="string">'select pgr_getColumnName('</span>||quote_literal(tabname)||<span class="string">','</span>||quote_literal(<span class="keyword">id</span>)||<span class="string">')'</span> <span class="keyword">INTO</span> idname;</span></span><br><span class="line">       IF idname is NULL then</span><br><span class="line">          raise notice  'ERROR: id column "%"  not found in %',id,tabname;</span><br><span class="line">          RETURN 'FAIL';</span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">       raise DEBUG 'Checking geometry column "%" column  in  % ',the_geom,tabname;</span><br><span class="line">       IF gname is not NULL then</span><br><span class="line">        <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">          <span class="keyword">raise</span> DEBUG <span class="string">'Checking the SRID of the geometry "%"'</span>, gname;</span></span><br><span class="line">          query= '<span class="operator"><span class="keyword">SELECT</span> ST_SRID(<span class="string">' || quote_ident(gname) || '</span>) <span class="keyword">as</span> srid <span class="string">'</span><br><span class="line">              || '</span> <span class="keyword">FROM</span> <span class="string">' || pgr_quote_ident(tabname)</span><br><span class="line">              || '</span> <span class="keyword">WHERE</span> <span class="string">' || quote_ident(gname)</span><br><span class="line">              || '</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">LIMIT</span> <span class="number">1</span><span class="string">';</span><br><span class="line">                EXECUTE QUERY</span><br><span class="line">              INTO sridinfo;</span><br><span class="line"></span><br><span class="line">          IF sridinfo IS NULL OR sridinfo.srid IS NULL THEN</span><br><span class="line">                RAISE NOTICE '</span><span class="keyword">ERROR</span>: Can <span class="keyword">not</span> determine the srid <span class="keyword">of</span> the geometry <span class="string">"%"</span> <span class="keyword">in</span> <span class="keyword">table</span> %<span class="string">', the_geom,tabname;</span><br><span class="line">                RETURN '</span>FAIL<span class="string">';</span><br><span class="line">          END IF;</span><br><span class="line">          srid := sridinfo.srid;</span><br><span class="line">          raise DEBUG '</span>  <span class="comment">-----&gt; SRID found %',srid;</span></span><br><span class="line">          <span class="keyword">EXCEPTION</span> <span class="keyword">WHEN</span> OTHERS <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'ERROR: Can not determine the srid of the geometry "%" in table %'</span>, the_geom,tabname;</span></span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">        <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line">        ELSE</span><br><span class="line">                raise notice  'ERROR: Geometry column "%"  not found in %',the_geom,tabname;</span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">        <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">  <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">       <span class="keyword">raise</span> DEBUG <span class="string">'Checking source column "%" and target column "%"  in  % '</span>,<span class="keyword">source</span>,target,tabname;</span></span><br><span class="line">       <span class="operator"><span class="keyword">EXECUTE</span> <span class="string">'select  pgr_getColumnName('</span>||quote_literal(tabname)||<span class="string">','</span>||quote_literal(<span class="keyword">source</span>)||<span class="string">')'</span> <span class="keyword">INTO</span> sourcename;</span></span><br><span class="line">       <span class="operator"><span class="keyword">EXECUTE</span> <span class="string">'select  pgr_getColumnName('</span>||quote_literal(tabname)||<span class="string">','</span>||quote_literal(target)||<span class="string">')'</span> <span class="keyword">INTO</span> targetname;</span></span><br><span class="line">       IF sourcename is not NULL and targetname is not NULL then</span><br><span class="line">                <span class="comment">--check that the are integer</span></span><br><span class="line">                <span class="operator"><span class="keyword">EXECUTE</span> <span class="string">'select data_type  from information_schema.columns where table_name = '</span>||quote_literal(tname)||</span><br><span class="line">                        <span class="string">' and table_schema='</span>||quote_literal(sname)||<span class="string">' and column_name='</span>||quote_literal(sourcename) <span class="keyword">into</span> sourcetype;</span></span><br><span class="line">                <span class="operator"><span class="keyword">EXECUTE</span> <span class="string">'select data_type  from information_schema.columns where table_name = '</span>||quote_literal(tname)||</span><br><span class="line">                        <span class="string">' and table_schema='</span>||quote_literal(sname)||<span class="string">' and column_name='</span>||quote_literal(targetname) <span class="keyword">into</span> targettype;</span></span><br><span class="line">                IF sourcetype not in('integer','smallint','bigint')  THEN</span><br><span class="line">                raise notice  'ERROR: source column "%" is not of integer type',sourcename;</span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">                <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">                IF targettype not in('integer','smallint','bigint')  THEN</span><br><span class="line">                raise notice  'ERROR: target column "%" is not of integer type',targetname;</span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">                <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">                raise DEBUG  '  <span class="comment">------&gt;OK ';</span></span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">       IF sourcename is NULL THEN</span><br><span class="line">            raise notice  'ERROR: source column "%"  not found in %',source,tabname;</span><br><span class="line">            RETURN 'FAIL';</span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">       IF targetname is NULL THEN</span><br><span class="line">            raise notice  'ERROR: target column "%"  not found in %',target,tabname;</span><br><span class="line">            RETURN 'FAIL';</span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">  <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       IF sourcename=targetname THEN</span><br><span class="line">    raise notice  'ERROR: source and target columns have the same name "%" in %',target,tabname;</span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">       IF sourcename=idname THEN</span><br><span class="line">    raise notice  'ERROR: source and id columns have the same name "%" in %',target,tabname;</span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">       IF targetname=idname THEN</span><br><span class="line">    raise notice  'ERROR: target and id columns have the same name "%" in %',target,tabname;</span><br><span class="line">                RETURN 'FAIL';</span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">      <span class="keyword">RAISE</span> DEBUG <span class="string">'Cheking "%" column in % is indexed'</span>,idname,tabname;</span></span><br><span class="line">      if (pgr_isColumnIndexed(tabname,idname)) then</span><br><span class="line">  RAISE DEBUG '  <span class="comment">------&gt;OK';</span></span><br><span class="line">      else</span><br><span class="line">        RAISE DEBUG ' <span class="comment">------&gt; Adding  index "%_%_idx".',tabname,idname;</span></span><br><span class="line">        <span class="operator"><span class="keyword">set</span> client_min_messages  <span class="keyword">to</span> <span class="keyword">warning</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'create  index '</span>||pgr_quote_ident(tname||<span class="string">'_'</span>||idname||<span class="string">'_idx'</span>)||<span class="string">'</span><br><span class="line">                         on '</span>||pgr_quote_ident(tabname)||<span class="string">' using btree('</span>||quote_ident(idname)||<span class="string">')'</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'set client_min_messages  to '</span>|| debuglevel;</span></span><br><span class="line">      <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">      <span class="keyword">RAISE</span> DEBUG <span class="string">'Cheking "%" column in % is indexed'</span>,sourcename,tabname;</span></span><br><span class="line">      if (pgr_isColumnIndexed(tabname,sourcename)) then</span><br><span class="line">  RAISE DEBUG '  <span class="comment">------&gt;OK';</span></span><br><span class="line">      else</span><br><span class="line">        RAISE DEBUG ' <span class="comment">------&gt; Adding  index "%_%_idx".',tabname,sourcename;</span></span><br><span class="line">        <span class="operator"><span class="keyword">set</span> client_min_messages  <span class="keyword">to</span> <span class="keyword">warning</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'create  index '</span>||pgr_quote_ident(tname||<span class="string">'_'</span>||sourcename||<span class="string">'_idx'</span>)||<span class="string">'</span><br><span class="line">                         on '</span>||pgr_quote_ident(tabname)||<span class="string">' using btree('</span>||quote_ident(sourcename)||<span class="string">')'</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'set client_min_messages  to '</span>|| debuglevel;</span></span><br><span class="line">      <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">      <span class="keyword">RAISE</span> DEBUG <span class="string">'Cheking "%" column in % is indexed'</span>,targetname,tabname;</span></span><br><span class="line">      if (pgr_isColumnIndexed(tabname,targetname)) then</span><br><span class="line">  RAISE DEBUG '  <span class="comment">------&gt;OK';</span></span><br><span class="line">      else</span><br><span class="line">        RAISE DEBUG ' <span class="comment">------&gt; Adding  index "%_%_idx".',tabname,targetname;</span></span><br><span class="line">        <span class="operator"><span class="keyword">set</span> client_min_messages  <span class="keyword">to</span> <span class="keyword">warning</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'create  index '</span>||pgr_quote_ident(tname||<span class="string">'_'</span>||targetname||<span class="string">'_idx'</span>)||<span class="string">'</span><br><span class="line">                         on '</span>||pgr_quote_ident(tabname)||<span class="string">' using btree('</span>||quote_ident(targetname)||<span class="string">')'</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'set client_min_messages  to '</span> ||debuglevel;</span></span><br><span class="line">      <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">      <span class="keyword">RAISE</span> DEBUG <span class="string">'Cheking "%" column in % is indexed'</span>,gname,tabname;</span></span><br><span class="line">      if (pgr_iscolumnindexed(tabname,gname)) then</span><br><span class="line">  RAISE DEBUG '  <span class="comment">------&gt;OK';</span></span><br><span class="line">      else</span><br><span class="line">        RAISE DEBUG ' <span class="comment">------&gt; Adding unique index "%_%_gidx".',tabname,gname;</span></span><br><span class="line">        <span class="operator"><span class="keyword">set</span> client_min_messages  <span class="keyword">to</span> <span class="keyword">warning</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'CREATE INDEX '</span></span><br><span class="line">            || quote_ident(tname || <span class="string">'_'</span> || gname || <span class="string">'_gidx'</span> )</span><br><span class="line">            || <span class="string">' ON '</span> || pgr_quote_ident(tabname)</span><br><span class="line">            || <span class="string">' USING gist ('</span> || quote_ident(gname) || <span class="string">')'</span>;</span></span><br><span class="line">        <span class="operator"><span class="keyword">execute</span> <span class="string">'set client_min_messages  to '</span>|| debuglevel;</span></span><br><span class="line">      <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line">       gname=quote_ident(gname);</span><br><span class="line">       idname=quote_ident(idname);</span><br><span class="line">       sourcename=quote_ident(sourcename);</span><br><span class="line">       targetname=quote_ident(targetname);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">       <span class="keyword">raise</span> DEBUG <span class="string">'initializing %'</span>,vertname;</span></span><br><span class="line">       <span class="operator"><span class="keyword">execute</span> <span class="string">'select * from pgr_getTableName('</span>||quote_literal(vertname)||<span class="string">')'</span> <span class="keyword">into</span> naming;</span></span><br><span class="line">       IF sname=naming.sname  AND vname=naming.tname  THEN</span><br><span class="line">           <span class="operator"><span class="keyword">execute</span> <span class="string">'TRUNCATE TABLE '</span>||pgr_quote_ident(vertname)||<span class="string">' RESTART IDENTITY'</span>;</span></span><br><span class="line">           <span class="operator"><span class="keyword">execute</span> <span class="string">'SELECT DROPGEOMETRYCOLUMN('</span>||quote_literal(sname)||<span class="string">','</span>||quote_literal(vname)||<span class="string">','</span>||quote_literal(<span class="string">'the_geom'</span>)||<span class="string">')'</span>;</span></span><br><span class="line">       ELSE</span><br><span class="line">           <span class="operator"><span class="keyword">set</span> client_min_messages  <span class="keyword">to</span> <span class="keyword">warning</span>;</span></span><br><span class="line">           <span class="operator"><span class="keyword">execute</span> <span class="string">'CREATE TABLE '</span>||pgr_quote_ident(vertname)||<span class="string">' (id bigserial PRIMARY KEY,cnt integer,chk integer,ein integer,eout integer)'</span>;</span></span><br><span class="line">       <span class="operator"><span class="keyword">END</span> <span class="keyword">IF</span>;</span></span><br><span class="line">       <span class="operator"><span class="keyword">execute</span> <span class="string">'select addGeometryColumn('</span>||quote_literal(sname)||<span class="string">','</span>||quote_literal(vname)||<span class="string">','</span>||</span><br><span class="line">                quote_literal(<span class="string">'the_geom'</span>)||<span class="string">','</span>|| srid||<span class="string">', '</span>||quote_literal(<span class="string">'POINT'</span>)||<span class="string">', 3)'</span>;</span></span><br><span class="line">       <span class="operator"><span class="keyword">execute</span> <span class="string">'CREATE INDEX '</span>||quote_ident(vname||<span class="string">'_the_geom_idx'</span>)||<span class="string">' ON '</span>||pgr_quote_ident(vertname)||<span class="string">'  USING GIST (the_geom)'</span>;</span></span><br><span class="line">       <span class="operator"><span class="keyword">execute</span> <span class="string">'set client_min_messages  to '</span>|| debuglevel;</span></span><br><span class="line">       raise DEBUG  '  <span class="comment">------&gt;OK';</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="operator"><span class="keyword">BEGIN</span></span><br><span class="line">    <span class="keyword">sql</span> = <span class="string">'select * from '</span>||pgr_quote_ident(tabname)||<span class="string">' WHERE true'</span>||rows_where ||<span class="string">' limit 1'</span>;</span></span><br><span class="line">    <span class="operator"><span class="keyword">EXECUTE</span> <span class="keyword">sql</span> <span class="keyword">into</span> <span class="keyword">i</span>;</span></span><br><span class="line">    sql = '<span class="operator"><span class="keyword">select</span> <span class="keyword">count</span>(*) <span class="keyword">from</span> <span class="string">'||pgr_quote_ident(tabname)||'</span> <span class="keyword">WHERE</span> (<span class="string">' || gname || '</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> <span class="string">'||</span><br><span class="line">    idname||'</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>)=<span class="literal">false</span> <span class="string">'||rows_where;</span><br><span class="line">    EXECUTE SQL  into notincluded;</span><br><span class="line">    EXCEPTION WHEN OTHERS THEN  BEGIN</span><br><span class="line">         RAISE NOTICE '</span><span class="keyword">ERROR</span>: Condition <span class="keyword">is</span> <span class="keyword">not</span> correct, please <span class="keyword">execute</span> the <span class="keyword">following</span> <span class="keyword">query</span> <span class="keyword">to</span> <span class="keyword">test</span> your condition<span class="string">';</span><br><span class="line">         RAISE NOTICE '</span>%<span class="string">',sql;</span><br><span class="line">         RETURN '</span>FAIL<span class="string">';</span><br><span class="line">    END;</span><br><span class="line">  END;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    BEGIN</span><br><span class="line">    raise notice '</span>Creating topology3d, Please <span class="keyword">wait</span>...<span class="string">';</span><br><span class="line">    execute '</span><span class="keyword">UPDATE</span> <span class="string">' || pgr_quote_ident(tabname) ||</span><br><span class="line">            '</span> <span class="keyword">SET</span> <span class="string">'||sourcename||'</span> = <span class="literal">NULL</span>,<span class="string">'||targetname||'</span> = <span class="literal">NULL</span><span class="string">';</span><br><span class="line">    rowcount := 0;</span><br><span class="line">    FOR points IN EXECUTE '</span><span class="keyword">SELECT</span> <span class="string">' || idname || '</span>::<span class="built_in">bigint</span> <span class="keyword">AS</span> <span class="keyword">id</span>,<span class="string">'</span><br><span class="line">        || '</span> PGR_StartPoint(<span class="string">' || gname || '</span>) <span class="keyword">AS</span> <span class="keyword">source</span>,<span class="string">'</span><br><span class="line">        || '</span> PGR_EndPoint(<span class="string">'   || gname || '</span>) <span class="keyword">AS</span> target<span class="string">'</span><br><span class="line">        || '</span> <span class="keyword">FROM</span> <span class="string">'  || pgr_quote_ident(tabname)</span><br><span class="line">        || '</span> <span class="keyword">WHERE</span> <span class="string">' || gname || '</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> <span class="string">' || idname||'</span> <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="string">'||rows_where</span><br><span class="line">    LOOP</span><br><span class="line"></span><br><span class="line">        rowcount := rowcount + 1;</span><br><span class="line">        IF rowcount % 1000 = 0 THEN</span><br><span class="line">            RAISE NOTICE '</span>% edges processed<span class="string">', rowcount;</span><br><span class="line">        END IF;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        source_id := pgr_pointToId3d(points.source, tolerance,vertname,srid);</span><br><span class="line">        target_id := pgr_pointToId3d(points.target, tolerance,vertname,srid);</span><br><span class="line">        BEGIN</span><br><span class="line">        sql := '</span><span class="keyword">UPDATE</span> <span class="string">' || pgr_quote_ident(tabname) ||</span><br><span class="line">            '</span> <span class="keyword">SET</span> <span class="string">'||sourcename||'</span> = <span class="string">'|| source_id::text || '</span>,<span class="string">'||targetname||'</span> = <span class="string">' || target_id::text ||</span><br><span class="line">            '</span> <span class="keyword">WHERE</span> <span class="string">' || idname || '</span> =  <span class="string">' || points.id::text;</span><br><span class="line"></span><br><span class="line">        IF sql IS NULL THEN</span><br><span class="line">            RAISE NOTICE '</span><span class="keyword">WARNING</span>: <span class="keyword">UPDATE</span> % <span class="keyword">SET</span> <span class="keyword">source</span> = %, target = % <span class="keyword">WHERE</span> % = % <span class="string">', tabname, source_id::text, target_id::text, idname,  points.id::text;</span><br><span class="line">        ELSE</span><br><span class="line">            EXECUTE sql;</span><br><span class="line">        END IF;</span><br><span class="line">        EXCEPTION WHEN OTHERS THEN</span><br><span class="line">            RAISE NOTICE '</span>%<span class="string">', SQLERRM;</span><br><span class="line">            RAISE NOTICE '</span>%<span class="string">',sql;</span><br><span class="line">            RETURN '</span>FAIL<span class="string">';</span><br><span class="line">        end;</span><br><span class="line">    END LOOP;</span><br><span class="line">    raise notice '</span><span class="comment">-------------&gt; TOPOLOGY 3D CREATED FOR  % edges', rowcount;</span></span><br><span class="line">    <span class="keyword">RAISE</span> <span class="keyword">NOTICE</span> <span class="string">'Rows with NULL geometry or NULL id: %'</span>,notincluded;</span></span><br><span class="line">    Raise notice 'Vertices table for table % is: %',pgr_quote_ident(tabname),pgr_quote_ident(vertname);</span><br><span class="line">    raise notice '<span class="comment">----------------------------------------------';</span></span><br><span class="line">    <span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line">    RETURN 'OK';</span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">END</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$BODY$</span><br><span class="line">  LANGUAGE plpgsql VOLATILE STRICT</span><br><span class="line">  COST 100;</span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">FUNCTION</span> <span class="keyword">public</span>.pgr_createtopology3d(<span class="built_in">text</span>, <span class="keyword">double</span> <span class="keyword">precision</span>, <span class="built_in">text</span>, <span class="built_in">text</span>, <span class="built_in">text</span>, <span class="built_in">text</span>, <span class="built_in">text</span>)</span><br><span class="line">  OWNER <span class="keyword">TO</span> postgres;</span></span><br><span class="line">COMMENT ON FUNCTION public.pgr_createtopology3d(text, double precision, text, text, text, text, text) IS 'args: edge_table,tolerance, the_geom:=''the_geom'',source:=''source'', target:=''target'',rows_where:=''true'' - fills columns source and target in the geometry table and creates a vertices table for selected rows';</span><br></pre></td></tr></table></figure></p>
<p>indrz_create_3d_networklines.sql<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- if not, go ahead and update</span></span><br><span class="line"><span class="comment">-- make sure tables dont exist</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="keyword">public</span>.yz_network_lines_04_routing;</span></span><br><span class="line"><span class="operator"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="keyword">public</span>.yz_network_lines_05_routing;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- convert to 3d coordinates with EPSG:3857</span></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> ogc_fid, ST_Force_3d(ST_Transform(ST_Force_2D(st_geometryN(wkb_geometry, <span class="number">1</span>)),<span class="number">3857</span>)) <span class="keyword">AS</span> wkb_geometry,</span><br><span class="line">  type_id, <span class="keyword">cost</span>, <span class="keyword">length</span>, <span class="number">0</span> <span class="keyword">AS</span> <span class="keyword">source</span>, <span class="number">0</span> <span class="keyword">AS</span> target</span><br><span class="line">  <span class="keyword">INTO</span> <span class="keyword">public</span>.yz_network_lines_04_routing</span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">public</span>.yz_network_lines_04;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> ogc_fid, ST_Force_3d(ST_Transform(ST_Force_2D(st_geometryN(wkb_geometry, <span class="number">1</span>)),<span class="number">3857</span>)) <span class="keyword">AS</span> wkb_geometry,</span><br><span class="line">  type_id, <span class="keyword">cost</span>, <span class="keyword">length</span>, <span class="number">0</span> <span class="keyword">AS</span> <span class="keyword">source</span>, <span class="number">0</span> <span class="keyword">AS</span> target</span><br><span class="line">  <span class="keyword">INTO</span> <span class="keyword">public</span>.yz_network_lines_05_routing</span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">public</span>.yz_network_lines_05;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- fill the 3rd coordinate according to their floor number</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_04_routing <span class="keyword">SET</span> wkb_geometry=ST_Translate(ST_Force_3Dz(wkb_geometry),<span class="number">0</span>,<span class="number">0</span>,<span class="number">4</span>);</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_05_routing <span class="keyword">SET</span> wkb_geometry=ST_Translate(ST_Force_3Dz(wkb_geometry),<span class="number">0</span>,<span class="number">0</span>,<span class="number">5</span>);</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_04_routing <span class="keyword">SET</span> <span class="keyword">length</span> =ST_Length(wkb_geometry);</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_05_routing <span class="keyword">SET</span> <span class="keyword">length</span> =ST_Length(wkb_geometry);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- no cost should be 0 or NULL/empty</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_04_routing <span class="keyword">SET</span> <span class="keyword">cost</span>=<span class="number">1</span> <span class="keyword">WHERE</span> <span class="keyword">cost</span>=<span class="number">0</span> <span class="keyword">or</span> <span class="keyword">cost</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_05_routing <span class="keyword">SET</span> <span class="keyword">cost</span>=<span class="number">1</span> <span class="keyword">WHERE</span> <span class="keyword">cost</span>=<span class="number">0</span> <span class="keyword">or</span> <span class="keyword">cost</span> <span class="keyword">IS</span> <span class="literal">NULL</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- update unique ids ogc_fid accordingly</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_04_routing <span class="keyword">SET</span> ogc_fid=ogc_fid+<span class="number">100000</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.yz_network_lines_05_routing <span class="keyword">SET</span> ogc_fid=ogc_fid+<span class="number">200000</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- merge all networkline floors into a single table for routing</span></span><br><span class="line"><span class="operator"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">public</span>.networklines_3857;</span></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> * <span class="keyword">INTO</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line">(<span class="keyword">SELECT</span> ogc_fid, wkb_geometry, <span class="keyword">length</span>, type_id, <span class="keyword">length</span>*o1.<span class="keyword">cost</span> <span class="keyword">as</span> total_cost,</span><br><span class="line">   <span class="number">4</span> <span class="keyword">as</span> layer <span class="keyword">FROM</span> <span class="keyword">public</span>.yz_network_lines_04_routing o1) <span class="keyword">UNION</span></span><br><span class="line">(<span class="keyword">SELECT</span> ogc_fid, wkb_geometry, <span class="keyword">length</span>, type_id, <span class="keyword">length</span>*o2.<span class="keyword">cost</span> <span class="keyword">as</span> total_cost,</span><br><span class="line">   <span class="number">5</span> <span class="keyword">as</span> layer <span class="keyword">FROM</span> <span class="keyword">public</span>.yz_network_lines_05_routing o2))</span><br><span class="line"><span class="keyword">as</span> foo <span class="keyword">ORDER</span> <span class="keyword">BY</span> ogc_fid;</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> wkb_geometry_gist_index</span><br><span class="line">   <span class="keyword">ON</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">USING</span> gist (wkb_geometry);</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> ogc_fid_idx</span><br><span class="line">   <span class="keyword">ON</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">USING</span> btree (ogc_fid <span class="keyword">ASC</span> <span class="keyword">NULLS</span> <span class="keyword">LAST</span>);</span></span><br><span class="line"></span><br><span class="line"><span class="operator"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> network_layer_idx</span><br><span class="line">  <span class="keyword">ON</span> <span class="keyword">public</span>.networklines_3857</span><br><span class="line">  <span class="keyword">USING</span> <span class="keyword">hash</span></span><br><span class="line">  (layer);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- create populate geometry view with info</span></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> Populate_Geometry_Columns(<span class="string">'public.networklines_3857'</span>::regclass);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- update stairs, ramps and elevators to match with the next layer</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">SET</span> wkb_geometry=ST_AddPoint(wkb_geometry,</span><br><span class="line">  ST_EndPoint(ST_Translate(wkb_geometry,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>)))</span><br><span class="line">  <span class="keyword">WHERE</span> type_id=<span class="number">3</span> <span class="keyword">OR</span> type_id=<span class="number">5</span> <span class="keyword">OR</span> type_id=<span class="number">7</span>;</span></span><br><span class="line"><span class="comment">-- remove the second last point</span></span><br><span class="line"><span class="operator"><span class="keyword">UPDATE</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">SET</span> wkb_geometry=ST_RemovePoint(wkb_geometry,ST_NPoints(wkb_geometry) - <span class="number">2</span>)</span><br><span class="line">  <span class="keyword">WHERE</span> type_id=<span class="number">3</span> <span class="keyword">OR</span> type_id=<span class="number">5</span> <span class="keyword">OR</span> type_id=<span class="number">7</span>;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- add columns source and target</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">add</span> <span class="keyword">column</span> <span class="keyword">source</span> <span class="built_in">integer</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.networklines_3857 <span class="keyword">add</span> <span class="keyword">column</span> target <span class="built_in">integer</span>;</span></span><br><span class="line"><span class="operator"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">public</span>.networklines_3857 OWNER <span class="keyword">TO</span> postgres;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- we dont need the temporary tables any more, delete them</span></span><br><span class="line"><span class="operator"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">public</span>.yz_network_lines_04_routing;</span></span><br><span class="line"><span class="operator"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">public</span>.yz_network_lines_05_routing;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- remove route nodes vertices table if exists</span></span><br><span class="line"><span class="operator"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="keyword">public</span>.networklines_3857_vertices_pgr;</span></span><br><span class="line"><span class="comment">-- building routing network vertices (fills source and target columns in those new tables)</span></span><br><span class="line"><span class="operator"><span class="keyword">SELECT</span> <span class="keyword">public</span>.pgr_createTopology3d(<span class="string">'public.networklines_3857'</span>, <span class="number">0.0001</span>, <span class="string">'wkb_geometry'</span>, <span class="string">'ogc_fid'</span>);</span></span><br></pre></td></tr></table></figure></p>
<p>参考：<br><a href="https://www.packtpub.com/big-data-and-business-intelligence/python-geospatial-analysis-cookbook" target="_blank" rel="external">《Python Geospatial Analysis Cookbook》</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/01/25/室内地图导入postgis/" data-id="cinjn73vi000g501apgeaxle2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gis-室内地图/">gis 室内地图</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ReactNative/">ReactNative</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/gis/">gis</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/ionic/">ionic</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/rails/">rails</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/厨艺/">厨艺</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/感想/">感想</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/昔日归档/">昔日归档</a><span class="category-list-count">78</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/50元/">50元</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/605/">605</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MFC/">MFC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/gis-室内地图/">gis 室内地图</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/wolf/">wolf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/书/">书</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/事业/">事业</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/做事/">做事</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/做人/">做人</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/出力/">出力</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/出钱/">出钱</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/刘翔/">刘翔</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/创业/">创业</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/史玉柱/">史玉柱</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/地震/">地震</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/坑/">坑</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多难兴邦/">多难兴邦</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/头七/">头七</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/室内地图/">室内地图</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/忠告/">忠告</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/成功/">成功</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/救急不救穷/">救急不救穷</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机会/">机会</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机遇/">机遇</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/校内/">校内</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/毕业/">毕业</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/毛泽东-实践-认识/">毛泽东;实践;认识</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/沉思录/">沉思录</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/法律/">法律</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/清华/">清华</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/灾难/">灾难</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/爱因斯坦/">爱因斯坦</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/狼/">狼</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/用心/">用心</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电梯/">电梯</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网站/">网站</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/老汉/">老汉</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/职业/">职业</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/补课/">补课</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/见义勇为/">见义勇为</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/角斗士/">角斗士</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/赚钱/">赚钱</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/50元/" style="font-size: 10px;">50元</a> <a href="/tags/605/" style="font-size: 10px;">605</a> <a href="/tags/MFC/" style="font-size: 10px;">MFC</a> <a href="/tags/gis-室内地图/" style="font-size: 10px;">gis 室内地图</a> <a href="/tags/wolf/" style="font-size: 10px;">wolf</a> <a href="/tags/书/" style="font-size: 10px;">书</a> <a href="/tags/事业/" style="font-size: 10px;">事业</a> <a href="/tags/做事/" style="font-size: 10px;">做事</a> <a href="/tags/做人/" style="font-size: 10px;">做人</a> <a href="/tags/出力/" style="font-size: 10px;">出力</a> <a href="/tags/出钱/" style="font-size: 10px;">出钱</a> <a href="/tags/刘翔/" style="font-size: 10px;">刘翔</a> <a href="/tags/创业/" style="font-size: 10px;">创业</a> <a href="/tags/史玉柱/" style="font-size: 10px;">史玉柱</a> <a href="/tags/地震/" style="font-size: 20px;">地震</a> <a href="/tags/坑/" style="font-size: 10px;">坑</a> <a href="/tags/多难兴邦/" style="font-size: 15px;">多难兴邦</a> <a href="/tags/头七/" style="font-size: 10px;">头七</a> <a href="/tags/室内地图/" style="font-size: 15px;">室内地图</a> <a href="/tags/忠告/" style="font-size: 10px;">忠告</a> <a href="/tags/成功/" style="font-size: 10px;">成功</a> <a href="/tags/救急不救穷/" style="font-size: 10px;">救急不救穷</a> <a href="/tags/机会/" style="font-size: 10px;">机会</a> <a href="/tags/机遇/" style="font-size: 10px;">机遇</a> <a href="/tags/校内/" style="font-size: 10px;">校内</a> <a href="/tags/毕业/" style="font-size: 10px;">毕业</a> <a href="/tags/毛泽东-实践-认识/" style="font-size: 10px;">毛泽东;实践;认识</a> <a href="/tags/沉思录/" style="font-size: 10px;">沉思录</a> <a href="/tags/法律/" style="font-size: 15px;">法律</a> <a href="/tags/清华/" style="font-size: 10px;">清华</a> <a href="/tags/灾难/" style="font-size: 10px;">灾难</a> <a href="/tags/爱因斯坦/" style="font-size: 10px;">爱因斯坦</a> <a href="/tags/狼/" style="font-size: 10px;">狼</a> <a href="/tags/用心/" style="font-size: 10px;">用心</a> <a href="/tags/电梯/" style="font-size: 10px;">电梯</a> <a href="/tags/网站/" style="font-size: 10px;">网站</a> <a href="/tags/老汉/" style="font-size: 10px;">老汉</a> <a href="/tags/职业/" style="font-size: 10px;">职业</a> <a href="/tags/补课/" style="font-size: 10px;">补课</a> <a href="/tags/见义勇为/" style="font-size: 10px;">见义勇为</a> <a href="/tags/角斗士/" style="font-size: 10px;">角斗士</a> <a href="/tags/赚钱/" style="font-size: 10px;">赚钱</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">April 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">November 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">May 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/06/">June 2012</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/05/">May 2012</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/09/">September 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/02/">February 2010</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/01/">January 2010</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/12/">December 2009</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/11/">November 2009</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/10/">October 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/08/">August 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/07/">July 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/03/">March 2009</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/01/">January 2009</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/11/">November 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">October 2008</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/09/">September 2008</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/08/">August 2008</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/07/">July 2008</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/06/">June 2008</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/05/">May 2008</a><span class="archive-list-count">17</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/04/28/find-closest-network-backend/">实现最短路径查找服务端api</a>
          </li>
        
          <li>
            <a href="/2016/04/20/rails-ajax-tips/">rails ajax tips</a>
          </li>
        
          <li>
            <a href="/2016/04/01/linux服务器常用命令/">linux服务器常用命令</a>
          </li>
        
          <li>
            <a href="/2016/03/22/正确配置geoserver标签label的姿势/">正确配置geoserver标签(label)的姿势</a>
          </li>
        
          <li>
            <a href="/2016/03/22/geoserver地图显示图标/">geoserver地图显示图标</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 sniffer<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/links" class="mobile-nav-link">Links</a>
  
</nav>
    

<script src="//ajax.useso.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>